// ????????????????????????????????????????????????????????????????
// ??????????????????????? URL Controller ?????????????????????????
// ????????????????????????????????????????????????????????????????

// ???????????????????????? File Modules ??????????????????????????
// ?? Data
const URLDB = require('../data/urlData');

const URLDATA = new URLDB();

exports.getAll = (req, res, next) => {

  req.templateVars.urls = URLDATA.getAll()
  
  next()
}

exports.getUserURLS = (req, res, next) => {
  
  if (req.templateVars.user === null) {
    req.templateVars.urls = null;
    return next()
  }
  
  req.templateVars.urls = URLDATA.getUserURLS(req.templateVars.user.username)
  next()
}

exports.createURL = (req, res, next) => {

  // ~~ Grab sent data
  const { longURL } = req.body;
  const { username } = req.templateVars.user

  // ~~ Generate a unique id
  const shortURL = generateRandomString();

  // ## Create entry in DB
  urlDB.createURL(shortURL, longURL);

  res.status(201).redirect(`/urls/${shortURL}`)
}

exports.updateURL = (req, res, next) => {

// ~~ Get params
const { shortURL } = req.params;

// ## update database
urlDB.updateURL(shortURL, req.body[shortURL])

// ^^ 204 response to main info page
res.status(204).redirect('/urls');
}

exports.deleteURL = (req, res, next) => {

// ~~ Grab key from params
const { shortURL } = req.params;

// ## Delete Entry in DB using key
urlDB.deleteURL(shortURL);

// ^^ 204 response to main info page
res.status(204).redirect('/urls');
}

exports.signup = (req, res, next) => {

  // res.render('signUpUser');
  res.send('hello')
}